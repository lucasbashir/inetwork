{% extends "network/layout.html" %}
{% load static %}

{% block body %}

{% for post in page_post %}
<a href="{% url 'profile' user_id=post.user.id %}">
<img src="{{ post.user.profile_pics.url }}" class="rounded-circle" width="100" height="100">
</a>
{% endfor %}

<div class="container">
  <div style="color: white;" class="row d-flex justify-content-center">
    <h3 class="col-4">Following: {{ following.count }}</h3>
    <h3 class="col-4">Followers: {{ follower.count }}</h3>
  </div>
  {% if user.is_authenticated %}
    {% if user != userProfile %}
      {% if isFollowing %}
        <form action="{% url 'unfollow' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="followUser" value="{{ userProfile }}" />
          <button type="submit" class="btn btn-danger">Unfollow</button>
        </form>
      {% else %}
        <form action="{% url 'follow' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="followUser" value="{{ userProfile }}" />
          <button type="submit" class="btn btn-primary">Follow</button>
        </form>
      {% endif %}
    {% endif %}
  {% endif %}
</div>


    {% for post in page_post %}
    <div class="card">
        <div class="card-body">
          <a href="{% url 'profile' user_id=post.user.id %}">
            <img src="{{ post.user.profile_pics.url }}" class="rounded-circle" width="50" height="50">
          </a>
          
            <!-- Display a link to the user's profile -->
            <a class="card-title" href="{% url 'profile' user_id=post.user.id %}">@{{post.user}}</a>
            <br>
            <br>
            <!-- Display the content of the post -->
            <h6 class="card-text" id="content_{{ post.id }}">{{ post.postContent }}</h6>
            <!-- Display the timestamp of the post -->
            <p class="card-text"><small class="text-muted">{{ post.timestamp }}</small></p>
            <ul class="list-group">
              {% for comment in post.postComment.all %}
              <li class="list-group-item">
                <a href="{% url 'profile' user_id=post.user.id %}">
                  <img src="{{ comment.author.profile_pics.url }}" class="rounded-circle" width="50" height="50">
                </a>
                <strong><a href="{% url 'profile' user_id=comment.author.id %}">{{ comment.author }}</a> wrote:</strong>
                {{ comment.message }}   
            </li>
            
              {% empty %}
                  <li class="list-group-item">No comments yet.</li>
              {% endfor %}
          </ul>
            <br>
            {% if user.is_authenticated %}
            <form action="{% url 'addComment' post_id=post.id %}" method="POST">
              {% csrf_token %}
              <div class="form-group">
                <span class="comment-field">
                <textarea type="text" id="new-comment" name="newComment" class="form-control rounded-0 shadow-none" rows="3" placeholder="Write a comment..." required></textarea>
              </span>
              </div>
              <div class="form-group">
                <span class="btn-comment">
                <button type="submit" class="btn btn-primary btn-sm" style="background-color: #1877f2; border-color: #1877f2;" id="comment-btn">
                  <i class="fas fa-paper-plane"></i> Comment
                </button>
              </span>
              </div>
            </form>
            {% endif %}
            {% if user.is_authenticated %}
                {% if user == post.user %}
                    <div class="edit-buttons">
                        <!-- Display an "Edit" button that opens the modal to edit the post -->
                        <button class="btn btn-primary" data-toggle="modal" data-target="#modal_edit_post_{{post.id}}">Edit</button>
                    </div>
                    <!-- The modal for editing a post -->
                    <div class="modal fade" id="modal_edit_post_{{post.id}}" tabindex="-1" role="dialog" aria-labelledby="modal_edit_post_{{post.id}}_" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Edit</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <!-- Textarea for editing the post's content -->
                                    <textarea rows="10" id="textarea_{{post.id}}" class="form-control" name="content">{{post.postContent}}</textarea>
                                </div>
                                <div class="modal-footer"></div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>     
                    <button type="button" class="btn btn-primary" onclick="submitHandler({{ posts.id }})">Save changes</button>
    
                  </div>
                </div>
              </div>
            </div>
            {% else %}
            
    <!-- Check if the current post has been liked by the authenticated user -->
    {% if posts.id in whoYouLiked %}
      
      <!-- This means that we already liked the post -->
      
      <!-- If the post has been liked, display a thumbs-down button -->
      
      
      {% else %}
      
      <!-- If the post has not been liked, display a thumbs-up button -->
      
      
      
      
      {% endif %}
      {% endif %} 
      {% endif %} 
      
    
      </div>
      </div>
      </div>
      <!-- End of the for loop -->
      {% endfor %}
    
      <!-- Pagination for navigating through the posts -->
      <nav aria-label="Page navigation example">
      <ul class="pagination d-flex justify-content-center">
      {% if page_post.has_previous %}
      <!-- If there is a previous page, display a "previous" button -->
      <li class="page-item"><a class="page-link" href="?page={{page_post.previous_page_number}}">Previous</a></li>
      {% endif %}
      {% if page_post.has_next %}
      <!-- If there is a next page, display a "next" button -->
      <li class="page-item"><a class="page-link" href="?page={{page_post.next_page_number}}">Next</a></li>
      {% endif %}
      </ul>
      </nav>

{% endblock %}