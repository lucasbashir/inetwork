{% extends "network/layout.html" %}
{% load custom_tags %}
{% load my_filters %}
{% load static %}
{% block body %}


<h1>Dear <a href="{% url 'profile' user_id=user.id %}">{{user.username}}</a>, these are the posts you follow</h1>


    {% for posts in page_post%}
    <div class="card">
      <div class="card-body">
        <a href="{% url 'profile' user_id=posts.user.id %}">
          <img src="{{ posts.user.profile_pics.url }}" class="rounded-circle" width="50" height="50">
        </a>

          <!-- Display a link to the user's profile -->
        <a class="card-title" href="{% url 'profile' user_id=posts.user.id %}">@{{posts.user}}</a>
        <br>
        <br>
        <!-- Display the content of the post -->
        <div class="card-text" id="content_{{ posts.id }}">
          {% for paragraph in posts.postContent|split_paragraphs %}
  {% if forloop.counter <= 7 %}
    <p>{{ paragraph|urlize }}</p>
  {% endif %}
{% endfor %}
{% if posts.postContent|split_paragraphs|length > 2 %}
  <p class="btn btn-link read-more" data-post="{{ posts.id }}">Read full content >>></p>
{% endif %}

<div class="card-body">
  {% if posts.post_image %}
    <img src="{{ posts.post_image.url }}" class="img-fluid" alt="Post Image">
  {% endif %}
</div>

        </div>
        <!-- Display the timestamp of the post -->
        <p class="card-text"><small class="text-muted">{{ posts.timestamp }}</small></p>

      <!-- Display the number of likes for the post -->
      <div class="react_space" id="react_space">
        {% if user.is_authenticated %}
            {% if request.user in posts.post_like.all %}
              <form action="{% url 'remove_like' post_id=posts.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="unlikePost" value="{{ posts.id }}" />
                <button>
                  <i class="fa fa-thumbs-down"></i> Unlike
                </button>
              </form>
            {% else %}
              <form action="{% url 'add_like' post_id=posts.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="likePost" value="{{ posts.id }}" />
                {% if posts.id %}
                <button style="background: none; border: none;" class="like-btn" data-post-id="{{ posts.id }}">
                  <h6><i class="fa fa-thumbs-up"></i> Like {{ posts.post_like.count }}</h6>
                </button>
                {% endif %}
              </form>
            {% endif %}
          {% endif %}

          <div class="reaction-button" id="reaction-buttons-{{ posts.id }}">
            {% if user.is_authenticated %}
              {% if request.user in posts.post_like.all %}
                <form action="{% url 'remove_like' post_id=posts.id %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="unlikePost" value="{{ posts.id }}" />
                  <button>
                    <i class="fa fa-thumbs-down"></i> Unlike
                  </button>
                </form>
              {% else %}
                <form action="{% url 'add_like' post_id=posts.id %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="likePost" value="{{ posts.id }}" />
                  <button style="background: none; border: none;">
                      <img src="/media/post_image/lov.gif" class="rounded-circle" width="50" height="50" alt="Maa Shaa Allah"/>
                  </button>

                </form>
              {% endif %}
            {% endif %}


            {% if user.is_authenticated %}
              {% if request.user in posts.postAllah.all %}
                <form action="{% url 'remove_akbar' post_id=posts.id %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="unlike_akbar" value="{{ posts.id }}" />
                  <button>
                    <i class="fa fa-thumbs-down"></i> Unlike
                  </button>
                </form>
              {% else %}
                <form action="{% url 'add_akbar' post_id=posts.id %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="likePost" value="{{ posts.id }}" />
                  <button style="background: none; border: none;">
                    <img src="/media/post_image/allah.gif" class="rounded-circle" width="50" height="50" alt="Allah akbar"/>

                  </button>
                </form>
              {% endif %}
            {% endif %}



        {% if user.is_authenticated %}
        {% if request.user in posts.postSubhanallah.all %}
        <form action="{% url 'remove_subhanallah' post_id=posts.id %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="unlike_subhanallah" value="{{ posts.id }}" />
        <button>
          <i class="fa fa-thumbs-down"></i> Unlike
        </button>
        </form>
        {% else %}
        <form action="{% url 'add_subhanallah' post_id=posts.id %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="subhanallahPost" value="{{ posts.id }}" />
        <button style="background: none; border: none;">
          <img src="/media/post_image/shock.gif" class="rounded-circle" width="50" height="50" alt="Subhanallah"/>

        </button>
        </form>
        {% endif %}
        {% endif %}

        {% if user.is_authenticated %}
        {% if request.user in posts.postLaa.all %}
        <form action="{% url 'remove_laa' post_id=posts.id %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="unlike_laa" value="{{ posts.id }}" />
        <button>
          <i class="fa fa-thumbs-down"></i> Unlike
        </button>
        </form>
        {% else %}
        <form action="{% url 'add_laa' post_id=posts.id %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="laaPost" value="{{ posts.id }}" />
        <img src="/media/post_image/thumbsdown.gif" class="rounded-circle" width="50" height="50" alt="La"/>
        </button>
        </form>
        {% endif %}
        {% endif %}
        </div>
        </div>

        <!--Urlize comments, read more commets and display comments-->
<ul class="list-group">
  {% for comment in posts.postComment.all|slice:":3" %}
    <li class="list-group-item">
      <a href="{% url 'profile' user_id=posts.user.id %}">
        <img src="{{ comment.author.profile_pics.url }}" class="rounded-circle" width="50" height="50">
      </a>
      <strong><a href="{% url 'profile' user_id=comment.author.id %}">{{ comment.author }}</a> wrote:</strong>
      <div class="card-text" id="content_{{ comment.id }}">
        {% for paragraph in comment.message|split_paragraphs|slice:":8" %}
          <p>{{ paragraph|urlize }}</p>
        {% endfor %}
        {% if comment.message|split_paragraphs|length > 5 %}
        <a href="{% url 'post_content' post_id=posts.id %}">
          <p class="btn btn-link read-more" data-post="{{ posts.id }}">Read full comment >>></p>
        </a>
        {% endif %}
      </div>
    </li>
  {% empty %}
    <li class="list-group-item">No comments yet.</li>
  {% endfor %}
  {% if posts.postComment.all|length > 3 %}
  <li class="list-group-item">
    <a href="{% url 'post_content' post_id=posts.id %}">
    <p class="btn btn-link read-more" data-post="{{ posts.id }}">Read more comments >>></p>
  </a>
  </li>
{% endif %}
</ul>

        <br>
        {% if user.is_authenticated %}
        <form action="{% url 'addComment' post_id=posts.id %}" method="POST">
          {% csrf_token %}
          <div class="form-group">
            <span class="comment-field">
            <textarea type="text" id="new-comment" name="newComment" class="form-control rounded-0 shadow-none" rows="3" placeholder="Write a comment..."></textarea>
          </span>
          </div>
          <div class="form-group">
            <span class="btn-comment">
            <button type="submit" class="btn btn-primary btn-sm" style="background-color: #1877f2; border-color: #1877f2;" id="comment-btn">
              <i class="fas fa-paper-plane"></i> Comment
            </button>
          </span>
          </div>
        </form>
        {% endif %}

          {% if user.is_authenticated %}
              {% if user == post.user %}
                  <div class="edit-buttons">
                      <!-- Display an "Edit" button that opens the modal to edit the post -->
                      <button class="btn btn-primary" data-toggle="modal" data-target="#modal_edit_post_{{post.id}}">Edit</button>
                  </div>
                  <!-- The modal for editing a post -->
                  <div class="modal fade" id="modal_edit_post_{{post.id}}" tabindex="-1" role="dialog" aria-labelledby="modal_edit_post_{{post.id}}_" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <button class="btn btn-primary" data-toggle="modal" data-target="#modal_edit_post_{{post.id}}" aria-label="Edit post">
                                      Edit
                                  </button>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                  <!-- Textarea for editing the post's content -->
                                  <textarea rows="10" id="textarea_{{post.id}}" class="form-control" name="content">{{post.postContent}}</textarea>
                              </div>
                              <div class="modal-footer"></div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary">Save changes</button>

                </div>
              </div>
            </div>
          </div>

    {% endif %}
    {% endif %}


    </div>
    </div>
    </div>

    {% empty %}
    <div>
      <h4 style="margin-top: 100px;">Kindly follow users to catch up with their posts on this page</h4>
    </div>

   {% endfor %}
   <!-- Pagination for navigating through the posts -->
  <nav aria-label="Page navigation example">
    <ul class="pagination d-flex justify-content-center">
    {% if page_post.has_previous %}
    <!-- If there is a previous page, display a "previous" button -->
    <li class="page-item"><a class="page-link" href="?page={{page_post.previous_page_number}}">Previous</a></li>
    {% endif %}
    {% if page_post.has_next %}
    <!-- If there is a next page, display a "next" button -->
    <li class="page-item"><a class="page-link" href="?page={{page_post.next_page_number}}">Next</a></li>
    {% endif %}
    </ul>
    </nav>
  {% endblock %}